<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notorious Nukem Squirrel – Home Hub</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
}

body {
    background: #000;
    font-family: "Press Start 2P", monospace, system-ui;
    color: #bffcff;
}

.hub {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: url("business_center_bg.png") no-repeat center/cover;
}

/* === TITLE === */
.logo {
    position: absolute;
    top: 3%;
    left: 45%;
    transform: translateX(-50%);
    padding: 10px 20px;
    font-size: 2.2rem;
    letter-spacing: 0.12em;
    color: #d56aff;
    background: rgba(0,0,0,0.65);
    border: 4px solid #00f0ff;
    box-shadow: 0 0 10px #b84dff, 0 0 25px #8a2be2, 0 0 40px #6a00ff;
    z-index: 2;
}

.logo span.symbol {
    margin-right: 12px;
    color: #00ff9c;
}

/* === SCRATCH PANEL === */
.scratch-panel {
    position: absolute;
    top: 2%;
    left: 75.5%;
    transform: translateX(-50%);
    width: 320px;
    height: 145px;
    background: #111;
    border-radius: 6px;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 0.75rem;
}

#scratch-canvas {
    position: absolute;
    top: 2%;
    left: 75.5%;
    transform: translateX(-50%);
    width: 320px;
    height: 145px;
    z-index: 3;
}

/* === PRESS START === */
.press-start {
    position: absolute;
    top: 16%;
    left: 50%;
    transform: translateX(-50%);
    animation: blink 1s steps(2) infinite;
}

@keyframes blink {
    50% { opacity: 0; }
}

/* === HUB BUTTONS === */
.menu-node {
    position: absolute;
    padding: 14px 22px;
    background: rgba(0,0,0,0.8);
    border: 2px solid #00ffc3;
    color: #e7ffff;
    text-decoration: none;
}

.menu-node::before {
    content: "■ ";
    color: #ffeb3b;
}

#start-game { bottom: 48%; left: 12%; }
#training { bottom: 78%; left: 12%; }
#load-game { bottom: 59%; left: 53%; }
#arsenal { bottom: 11%; left: 22%; }
#options { bottom: 29%; left: 53%; }
#credits { bottom: 18%; left: 60%; }
#extras { bottom: 71%; right: 10%; }

/* === FLAG PANEL === */
.flag-panel {
    position: absolute;
    bottom: 3%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    padding: 12px;
    background: rgba(0,0,0,0.85);
    border: 2px solid #00ffc3;
    z-index: 10;
}

.flag-panel input,
.flag-panel select {
    background: #000;
    border: 1px solid #00ffc3;
    color: #00ffc3;
    padding: 6px;
}

.flag-panel button {
    background: #00ffc3;
    border: none;
    padding: 6px 12px;
    font-weight: bold;
    cursor: pointer;
}

/* === LEADERBOARD === */
.leaderboard-panel {
    position: absolute;
    top: 55%;
    left: 88%;
    transform: translateX(-50%);
    width: 320px;
    background: rgba(0,0,0,0.85);
    border: 2px solid #00ffc3;
    padding: 10px;
    font-size: 0.7rem;
}

#leaderboard td {
    padding: 4px;
    border-bottom: 1px solid rgba(0,255,195,0.25);
}

.rank { color: #ffeb3b; }
.completed { color: #00ffc3; text-align: right; }
</style>
</head>

<body>

<div class="hub">

<div class="logo"><span class="symbol">¤</span>NOTORIOUS NUKEM SQUIRREL</div>

<div class="scratch-panel">
TOP-SECRET BRIEFING<br>SCRATCH TO REVEAL
</div>
<canvas id="scratch-canvas"></canvas>

<div class="press-start">PRESS START TO SPAWN</div>

<a href="nukem.html" class="menu-node" id="start-game">Stage 1 - Hollywood Holocaust</a>
<a href="#" class="menu-node" id="training">stage 2 - Dark Side</a>
<a href="#" class="menu-node" id="load-game">Stage 3 - Raw Meat</a>
<a href="#" class="menu-node" id="arsenal">Stage 4 - L.A Rumble</a>
<a href="#" class="menu-node" id="options">Stage 5 - Hotel Hell</a>
<a href="redlight/door.html" class="menu-node" id="credits">Stage 6 - Red Light District</a>
<a href="terminal.html" class="menu-node" id="extras">Stage 7 - Crash Course</a>

<!-- LEADERBOARD -->
<div class="leaderboard-panel">
<b>LEADERBOARD</b>
<table id="leaderboard"></table>
</div>

<!-- FLAG SUBMIT -->
<div class="flag-panel">
<input id="username" placeholder="USERNAME">
<select id="stage">
<option value="1">STAGE 1</option>
<option value="2">STAGE 2</option>
<option value="3">STAGE 3</option>
<option value="4">STAGE 4</option>
<option value="5">STAGE 5</option>
<option value="5">STAGE 6</option>
<option value="5">STAGE 7</option>
<option value="5">STAGE 8</option>
</select>
<input id="flag" placeholder="FLAG">
<button onclick="submitFlag()">SUBMIT</button>
</div>

</div>

<script>
const API = "https://api.notorioussquirrel.com";
const userEl = document.getElementById("username");
const stageEl = document.getElementById("stage");

userEl.value = localStorage.getItem("ctf_user") || "";
stageEl.value = localStorage.getItem("ctf_stage") || "1";

userEl.onchange = () => localStorage.setItem("ctf_user", userEl.value);
stageEl.onchange = () => localStorage.setItem("ctf_stage", stageEl.value);

async function submitFlag() {
  const res = await fetch(`${API}/api/submit`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      username: userEl.value,
      stage: Number(stageEl.value),
      flag: document.getElementById("flag").value
    })
  });
  const data = await res.json();
  alert(res.ok ? data.message : data.detail);
  loadLeaderboard();
}

async function loadLeaderboard() {
  const table = document.getElementById("leaderboard");
  const res = await fetch(`${API}/api/leaderboard`);
  const data = await res.json();
  table.innerHTML = "";
  data.forEach((r,i)=>{
    table.innerHTML += `<tr>
      <td class="rank">#${i+1}</td>
      <td>${r.username}</td>
      <td class="completed">${r.completed}</td>
    </tr>`;
  });
}
loadLeaderboard();
setInterval(loadLeaderboard,10000);
</script>

<script>
(function(){
const c=document.getElementById("scratch-canvas"),x=c.getContext("2d");
const img=new Image(); img.src="nukemsquirrel.png";
img.onload=()=>{c.width=320;c.height=145;x.drawImage(img,0,0,320,145);}
let d=false;
c.onmousedown=()=>d=true;
window.onmouseup=()=>d=false;
c.onmousemove=e=>{
 if(!d)return;
 x.globalCompositeOperation="destination-out";
 x.beginPath();
 x.arc(e.offsetX,e.offsetY,18,0,Math.PI*2);
 x.fill();
};
})();
</script>

</body>
</html>
