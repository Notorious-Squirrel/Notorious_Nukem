<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notorious Nukem Squirrel – Home Hub</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    height: 100%;
}

body {
    background: #000;
    font-family: "Press Start 2P", monospace, system-ui;
    color: #bffcff;
}

.hub {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: url("business_center_bg.png") no-repeat center/cover;
}

/* === TITLE === */
.logo {
    position: absolute;
    top: 3%;
    left: 45%;
    transform: translateX(-50%);
    padding: 10px 20px;
    font-size: 2.2rem;
    letter-spacing: 0.12em;
    color: #d56aff;
    background: rgba(0,0,0,0.65);
    border: 4px solid #00f0ff;
    box-shadow: 0 0 10px #b84dff, 0 0 25px #8a2be2, 0 0 40px #6a00ff;
    z-index: 2;
}

.logo span.symbol {
    margin-right: 12px;
    color: #00ff9c;
}

/* === SCRATCH PANEL === */
.scratch-panel {
    position: absolute;
    top: 2%;
    left: 75.5%;
    transform: translateX(-50%);
    width: 320px;
    height: 145px;
    background: #111;
    border-radius: 6px;
    z-index: 1;

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 0.75rem;
    padding: 10px;
    box-sizing: border-box;
}

/* Scratch-off canvas overlay (this hides the text until scratched) */
#scratch-canvas {
    position: absolute;
    top: 2%;
    left: 75.5%;
    transform: translateX(-50%);
    width: 320px;
    height: 145px;
    z-index: 3;
    touch-action: none;
    cursor: pointer;
}

/* === PRESS START === */
.press-start {
    position: absolute;
    top: 16%;
    left: 50%;
    transform: translateX(-50%);
    animation: blink 1s steps(2) infinite;
    z-index: 4;
}

@keyframes blink {
    50% { opacity: 0; }
}

/* === HUB BUTTONS === */
.menu-node {
    position: absolute;
    padding: 14px 22px;
    background: rgba(0,0,0,0.8);
    border: 2px solid #00ffc3;
    color: #e7ffff;
    text-decoration: none;
    z-index: 6;
}

.menu-node::before {
    content: "■ ";
    color: #ffeb3b;
}

#start-game { bottom: 48%; left: 12%; }
#training   { bottom: 78%; left: 12%; }
#load-game  { bottom: 59%; left: 53%; }
#arsenal    { bottom: 11%; left: 22%; }
#options    { bottom: 29%; left: 53%; }
#credits    { bottom: 18%; left: 64%; }
#extras     { bottom: 71%; right: 10%; }

/* === FLAG PANEL === */
.flag-panel {
    position: absolute;
    bottom: 3%;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    padding: 12px;
    background: rgba(0,0,0,0.85);
    border: 2px solid #00ffc3;
    z-index: 10;
}

.flag-panel input,
.flag-panel select {
    background: #000;
    border: 1px solid #00ffc3;
    color: #00ffc3;
    padding: 6px;
}

.flag-panel button {
    background: #00ffc3;
    border: none;
    padding: 6px 12px;
    font-weight: bold;
    cursor: pointer;
}

/* === LEADERBOARD === */
.leaderboard-panel {
    position: absolute;
    top: 55%;
    left: 88%;
    transform: translateX(-50%);
    width: 320px;
    background: rgba(0,0,0,0.85);
    border: 2px solid #00ffc3;
    padding: 10px;
    font-size: 0.7rem;
    z-index: 10;
}

#leaderboard td {
    padding: 4px;
    border-bottom: 1px solid rgba(0,255,195,0.25);
}

/* Static Nukem Squirrel character */
.nukem-squirrel {
    position: absolute;
    bottom: 12%;
    left: 6%;
    width: 96px;
    height: auto;
    image-rendering: pixelated;
    z-index: 5;
    pointer-events: none;
}

.rank { color: #ffeb3b; }
.completed { color: #00ffc3; text-align: right; }
</style>
</head>

<body>

<div class="hub">
    <!-- Static Nukem Squirrel character -->
    <img src="nukemsuirrel.png" alt="Nukem Squirrel" class="nukem-squirrel"/>

    <div class="logo"><span class="symbol">¤</span>NOTORIOUS NUKEM SQUIRREL</div>

    <!-- Hidden message behind scratch -->
    <div class="scratch-panel">
        TOP-SECRET BRIEFING<br>
        SCRATCH TO REVEAL<br><br>
        NEXUS ENTRY CODE: <b>FLAG{S5-OMEGA}</b>
    </div>

    <!-- Scratch layer on top -->
    <canvas id="scratch-canvas"></canvas>

    <div class="press-start">PRESS START TO SPAWN</div>

    <a href="nukem.html" class="menu-node" id="start-game">Stage 1 - Hollywood Holocaust</a>
    <a href="#" class="menu-node" id="training">Stage 2 - Dark Side</a>
    <a href="#" class="menu-node" id="load-game">Stage 3 - Raw Meat</a>
    <a href="#" class="menu-node" id="arsenal">Stage 4 - L.A Rumble</a>
    <a href="#" class="menu-node" id="options">Stage 5 - Hotel Hell</a>
    <a href="redlight/door.html" class="menu-node" id="credits">Stage 6 - Red Light District</a>
    <a href="terminal.html" class="menu-node" id="extras">Stage 7 - Crash Course</a>

    <!-- LEADERBOARD -->
    <div class="leaderboard-panel">
        <b>LEADERBOARD</b>
        <table id="leaderboard"></table>
    </div>

    <!-- FLAG SUBMIT -->
    <div class="flag-panel">
        <input id="username" placeholder="USERNAME">
        <select id="stage">
            <option value="1">STAGE 1</option>
            <option value="2">STAGE 2</option>
            <option value="3">STAGE 3</option>
            <option value="4">STAGE 4</option>
            <option value="5">STAGE 5</option>
            <option value="6">STAGE 6</option>
            <option value="7">STAGE 7</option>
            <option value="8">STAGE 8</option>
        </select>
        <input id="flag" placeholder="FLAG">
        <button onclick="submitFlag()">SUBMIT</button>
    </div>
</div>

<script>
const API = "https://api.notorioussquirrel.com";
const userEl = document.getElementById("username");
const stageEl = document.getElementById("stage");

userEl.value = localStorage.getItem("ctf_user") || "";
stageEl.value = localStorage.getItem("ctf_stage") || "1";

userEl.onchange = () => localStorage.setItem("ctf_user", userEl.value);
stageEl.onchange = () => localStorage.setItem("ctf_stage", stageEl.value);

async function submitFlag() {
  try{
    const res = await fetch(`${API}/api/submit`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        username: userEl.value,
        stage: Number(stageEl.value),
        flag: document.getElementById("flag").value
      })
    });
    const data = await res.json().catch(()=> ({}));
    alert(res.ok ? (data.message || "Submitted") : (data.detail || "Submit failed"));
    loadLeaderboard();
  } catch (e){
    alert("API not reachable right now.");
  }
}

async function loadLeaderboard() {
  const table = document.getElementById("leaderboard");
  try{
    const res = await fetch(`${API}/api/leaderboard`);
    const data = await res.json();
    table.innerHTML = "";
    data.forEach((r,i)=>{
      table.innerHTML += `<tr>
        <td class="rank">#${i+1}</td>
        <td>${r.username}</td>
        <td class="completed">${r.completed}</td>
      </tr>`;
    });
  } catch(e){
    table.innerHTML = `<tr><td>Leaderboard offline</td></tr>`;
  }
}
loadLeaderboard();
setInterval(loadLeaderboard, 10000);
</script>

<script>
(() => {
  const canvas = document.getElementById("scratch-canvas");
  const ctx = canvas.getContext("2d");
  const img = new Image();

  // IMPORTANT: this is the top layer image you requested
  img.src = "nukemsuirrel.png";

  function resizeAndDraw() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.round(rect.width);
    canvas.height = Math.round(rect.height);

    // Draw the image scaled to fully cover the scratch area
    ctx.globalCompositeOperation = "source-over";
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (img.complete) {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }
  }

  img.onload = resizeAndDraw;
  window.addEventListener("resize", resizeAndDraw);

  // If cached
  if (img.complete) resizeAndDraw();

  let down = false;

  function getPos(e){
    const rect = canvas.getBoundingClientRect();
    const p = (e.touches && e.touches[0]) ? e.touches[0] : e;
    return { x: p.clientX - rect.left, y: p.clientY - rect.top };
  }

  function scratch(e){
    if(!down) return;
    e.preventDefault();
    const {x,y} = getPos(e);
    ctx.globalCompositeOperation = "destination-out";
    ctx.beginPath();
    ctx.arc(x, y, 18, 0, Math.PI * 2);
    ctx.fill();
  }

  canvas.addEventListener("mousedown", (e)=>{ down = true; scratch(e); });
  window.addEventListener("mouseup", ()=>{ down = false; });
  canvas.addEventListener("mousemove", scratch);

  canvas.addEventListener("touchstart", (e)=>{ down = true; scratch(e); }, {passive:false});
  window.addEventListener("touchend", ()=>{ down = false; });
  canvas.addEventListener("touchmove", scratch, {passive:false});
})();
</script>

</body>
</html>
